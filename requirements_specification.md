# かんたんプレイ MIDI 要件定義書

## 1. プロジェクト概要

### 1.1 目的

「かんぷれ」というガジェットをコントロールするための Python スクリプトを開発する。

### 1.2 システム名

かんたんプレイ MIDI（Kantan-Play-MIDI）

## 2. 機能要件

### 2.1 入力処理

- JSON 形式のデータファイルを入力として受け取る
- JSON ファイルから以下のパラメータを読み取る：
  - slot（スロット番号）
  - tempo（テンポ/BPM）
  - notes（音符情報の配列）

### 2.2 データ変換処理

- MIDI.json ファイルを参照して、各パラメータを MIDI ノートナンバーに変換する
- 変換ルール：
  - **slot**: 1-8 の数字を配列インデックスとして使用
  - **degree**: 音階を表す文字列（1, 2b, 2, 3b, 3, 4, 5b, 5, 6b, 6, 7b, 7）を配列インデックスに変換
  - **modifier1/2/3**: 0-8 の数字。0 は何もしない、1-8 を配列インデックスとして使用

### 2.3 MIDI 出力処理

- 選択可能な MIDI インターフェースを通じて MIDI 信号を出力
- すべての MIDI 信号はチャンネル 1 で送信

### 2.4 演奏制御

- 各パラメータは物理的なボタンに対応
- MIDI ノートオン/オフメッセージでボタンの押下・解放をシミュレート

## 3. 詳細仕様

### 3.1 スロット選択動作

1. slot の数字に対応する MIDI ノートナンバーをノートオンで送信
2. 50 ミリ秒後に同じノートナンバーのノートオフを送信

### 3.2 音符演奏動作

1. modifier1, 2, 3 のうち 0 以外の値を持つものに対応する MIDI ノートオンを送信（同時押し）
2. degree に対応する MIDI ノートオンを送信
3. degree のノートオフを送信
4. modifier のノートオフを送信

### 3.3 テンポ制御

- tempo は BPM（Beats Per Minute）を表す
- degree ボタンを 8 回押すと 4 拍となる
- この拍に基づいて次の notes 配列の要素に進む
- すべての notes 配列を処理したら演奏終了

## 4. 入力データ仕様

### 4.1 JSON ファイル構造

```json
{
  "slot": 数値（1-8）,
  "tempo": 数値（BPM）,
  "notes": [
    {
      "degree": 文字列（音階）,
      "modifier1": 数値（0-8）,
      "modifier2": 数値（0-8）,
      "modifier3": 数値（0-8）
    }
  ]
}
```

### 4.2 MIDI.json 構造

```json
{
  "slot": [MIDIノートナンバーの配列（8要素）],
  "notes": [MIDIノートナンバーの配列（12要素）],
  "modifier1": [MIDIノートナンバーの配列（8要素）],
  "modifier2": [MIDIノートナンバーの配列（8要素）],
  "modifier3": [MIDIノートナンバーの配列（8要素）]
}
```

## 5. 非機能要件

### 5.1 インターフェース要件

- MIDI インターフェースを選択できる UI 機能
- コマンドライン引数または GUI での選択をサポート

### 5.2 タイミング要件

- スロット選択のノートオン/オフ間隔：50 ミリ秒（固定）
- テンポに基づいた正確なタイミング制御

### 5.3 エラー処理

- 無効な JSON 形式の検出と適切なエラーメッセージ
- MIDI デバイスが見つからない場合の処理
- 範囲外のパラメータ値の検証

## 6. 制約事項

- すべての MIDI 通信はチャンネル 1 を使用
- modifier 値が 0 の場合は、該当する modifier ボタンは押さない
- degree の値は指定された 12 音階のみサポート

## 7. 今後の検討事項

- 複数チャンネルのサポート
- リアルタイム演奏機能
- MIDI ファイルエクスポート機能
- 演奏の一時停止・再開機能
